!function(e){var t={};function o(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(n,s,function(t){return e[t]}.bind(null,s));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=17)}([function(e,t,o){e.exports={...o(4),...o(2),...o(12),...o(15)}},function(e,t,o){const{createResponseType:n}=o(8),s=n("application/json; charset=utf-8");e.exports={json:s}},function(e,t,o){e.exports={...o(3),...o(1),...o(9),...o(10),...o(11)}},function(e,t,o){const{json:n}=o(1);e.exports={error:(e=500,t="Internal Server Error.")=>n({..."object"==typeof t?t:{status:e,error:t}},{status:e})}},function(e,t,o){e.exports={...o(5),...o(6),...o(7)}},function(e,t){e.exports={withContent:async e=>{let t=e.headers.get("content-type");e.content=void 0;try{t&&t.includes("application/json")&&(e.content=await e.json())}catch(e){}}}},function(e,t){e.exports={withCookies:e=>{e.cookies={};try{e.cookies=(e.headers.get("Cookie")||"").split(/;\s*/).map(e=>e.split("=")).reduce((e,[t,o])=>(e[t]=o,e),{})}catch(e){}}}},function(e,t){e.exports={withParams:e=>{for(const t in e.params||{})e[t]=e.params[t]}}},function(e,t){e.exports={createResponseType:(e="text/plain; charset=utf-8")=>(t,o={})=>{const{headers:n={},...s}=o;return"object"==typeof t?new Response(JSON.stringify(t),{headers:{"Content-Type":e,...n},...s}):new Response(t,o)}}},function(e,t,o){const{error:n}=o(3);e.exports={missing:(e="Not found.")=>n(404,e)}},function(e,t,o){const{json:n}=o(1);e.exports={status:(e,t)=>t?n({..."object"==typeof t?t:{status:e,message:t}},{status:e}):new Response(null,{status:e})}},function(e,t){e.exports={text:(e,t={})=>new Response(e,t)}},function(e,t,o){e.exports={...o(13)}},function(e,t,o){"use strict";const{Router:n}=o(14),{error:s}=o(2);e.exports={ThrowableRouter:(e={})=>{const{stack:t=!1}=e;return new Proxy(n(e),{get:(e,o)=>(...n)=>"handle"===o?e[o](...n).catch(e=>s(e.status||500,{status:e.status||500,error:e.message,stack:t&&e.stack||void 0})):e[o](...n)})}}},function(e,t){e.exports={Router:({base:e="",routes:t=[]}={})=>({__proto__:new Proxy({},{get:(o,n,s)=>(o,...r)=>t.push([n.toUpperCase(),RegExp(`^${(e+o).replace(/(\/?)\*/g,"($1.*)?").replace(/\/$/,"").replace(/:(\w+)(\?)?(\.)?/g,"$2(?<$1>[^/]+)$2$3").replace(/\.(?=[\w(])/,"\\.")}/*$`),r])&&s}),routes:t,async handle(e,...o){let n,s,r=new URL(e.url);for(var[i,a,u]of(e.query=Object.fromEntries(r.searchParams),t))if((i===e.method||"ALL"===i)&&(s=r.pathname.match(a)))for(var c of(e.params=s.groups,u))if(void 0!==(n=await c(e.proxy||e,...o)))return n}})}},function(e,t,o){e.exports={...o(16)}},function(e,t){class o extends Error{constructor(e=500,t="Internal Error."){super(t),this.name="StatusError",this.status=e}}e.exports={StatusError:o}},function(e,t,o){"use strict";o.r(t);var n=o(0);const s=Object(n.ThrowableRouter)({base:"/api"});s.get("/test",async e=>(console.log("Received new request: "+e.url),new Response("Test GET",{status:200}))),s.get("/books",async e=>{console.log("Received new request: "+e.url);let t=await TITLES.list();return console.log(JSON.stringify(t)),Object(n.json)(t.keys)}),s.get("/books/:id",n.withParams,async e=>{console.log("Received new request: "+e.url);let t=await TITLES.get(e.id);return console.log(t),t?Object(n.json)(t):Object(n.missing)("That book was not found.")}),s.post("/books",n.withContent,async e=>{console.log("Received new request: "+e.url);let t=e.content;if("title"in t){let e=((e=21)=>{let t="",o=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let n=63&o[e];t+=n<36?n.toString(36):n<62?(n-26).toString(36).toUpperCase():n<63?"_":"-"}return t})(),{title:o,author:n,synopsis:s}=t,r={title:o,author:n,synopsis:s};return await TITLES.put(e,JSON.stringify(r)),new Response("Book created: "+JSON.stringify(r),{status:200})}return new Response("Missing title",{status:400})}),s.put("/books/:id",n.withContent,n.withParams,async e=>{console.log("Received new request: "+e.url);let t=e.content;if("title"in t){let{title:o,author:n,synopsis:s}=t,r={title:o,author:n,synopsis:s};return await TITLES.get(e.id)?(await TITLES.put(e.id,JSON.stringify(r)),new Response("Book modified: "+JSON.stringify(r),{status:200})):new Response("No book found with that id",{status:400})}return new Response("Missing title",{status:400})}),s.delete("/books/:id",n.withParams,async e=>{if(console.log("Received new request: "+e.url),await TITLES.get(e.id)){await TITLES.delete(e.id);return new Response("Book deleted: "+e.id,{status:200})}return new Response("No book found with that id",{status:400})}),s.all("*",()=>Object(n.missing)("Are you sure about that?")),addEventListener("fetch",e=>e.respondWith(s.handle(e.request)))}]);